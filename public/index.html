<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="SaasHup">
  <meta name="author" content="LaV">
  <title>Netbox Docker Agent</title>
  <link rel="icon" href="https://saashup.com/img/logo_saashup.png">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/css/bootstrap.min.css"
    integrity="sha512-GQGU0fMMi238uA+a/bdWJfpUGKUkBdgfFdgBm72SUQ6BeyWjoY/ton0tEjH+OSH9iP4Dfh+7HM0I9f5eR0L/4w=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
    integrity="sha512-iBBXm8fW90+nuLcSKlbmrPcLa0OT92xO1BIsZ+ywDWZCvqsWgccV3gFoRBv0z+8dLJgyAHIhR35VZc2oM/gI1w=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/xterm/5.5.0/xterm.min.css"
    integrity="sha512-XpXUuzg5afNt1bsgnrOesXP70TLH8tXYYK5sK+Y0UV+YBvJn9EfRFYWy4HT3TVDfH0nl1CO0lwOxIrt2gk9qjg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"
    integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/js/bootstrap.bundle.min.js"
    integrity="sha512-pax4MlgXjHEPfCwcJLQhigY7+N8rt6bVvWLFyUMuxShv170X53TRzGPmPkZmGBhk+jikR8WBM4yl7A9WMHHqvg=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/apexcharts/3.52.0/apexcharts.min.js"
    integrity="sha512-piY4QAXPoG2xLdUZZbcc5klXzMxckrQKY9A2o6nKDRt9inolvvLbvGPC+z9IZ29b28UJlD05B7CjxxPaxh4bjQ=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xterm/5.5.0/xterm.js"
    integrity="sha512-Gujw5GajF5is3nMoGv9X+tCMqePLL/60qvAv1LofUZTV9jK8ENbM9L+maGmOsNzuZaiuyc/fpph1KT9uR5w3CQ=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="/js/docker-exec-client.js"></script>
</head>

<body class="d-flex flex-column">

  <style>
    html,
    body {
      height: 100%;
      margin: 0;
      font-family: Arial, sans-serif;
    }

    body {
      display: flex;
      flex-direction: column;
    }

    .nav-link {
      border-bottom: 3px solid transparent;
    }

    .nav-link.active {
      border-bottom: 3px solid #0dcaf0;
      color: #0dcaf0;
    }

    .nav-link:hover {
      border-bottom: 3px solid #0dcaf0;
      color: #0dcaf0;
    }

    .no-transition {
      -webkit-transition: height 0.01s;
      -moz-transition: height 0.01s;
      -ms-transition: height 0.01s;
      -o-transition: height 0.01s;
      transition: height 0.01s;
    }
  </style>

  <div class="modal fade" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false" id="modalNotification">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header text-primary">
          <h5 class="modal-title" id="modalNotificationTitle"></h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body text-center">
          <p id="modalNotificationContent"></p>
        </div>
      </div>
    </div>
  </div>

  <nav class="navbar navbar-expand-lg" id="navbar">
    <div class="container-fluid">
      <a class="navbar-brand" style="padding: 0 0 0 0;" href="https://saashup.com"><img
          src="https://saashup.com/images/saashup_logo_circle.svg" height="64px" /></a>
      <button class="navbar-toggler border-primary" type="button" data-bs-toggle="collapse"
        data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false"
        aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse no-transition" id="navbarCollapse">
        <ul class="navbar-nav me-auto mb-2 mb-md-0">
          <li class="nav-item">
            <a class="nav-link" aria-current="page" href="#home" id="nav-home-btn" data-bs-toggle="collapse"
              data-bs-target="#navbarCollapse"><i class="fas fa-home"></i> Home</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" aria-current="page" href="#containers" id="nav-containers-btn" data-bs-toggle="collapse"
              data-bs-target="#navbarCollapse"><i class="fab fa-docker"></i> Containers <span
                class="badge rounded-pill bg-primary" id="containers_num">?</span></a>
          </li>
          <li class="nav-item">
            <a class="nav-link" aria-current="page" href="#images" id="nav-images-btn" data-bs-toggle="collapse"
              data-bs-target="#navbarCollapse"><i class="fas fa-clone"></i> Images <span
                class="badge rounded-pill bg-primary" id="images_num">?</span></a>
          </li>
          <li class="nav-item">
            <a class="nav-link" aria-current="page" href="#networks" id="nav-networks-btn" data-bs-toggle="collapse"
              data-bs-target="#navbarCollapse"><i class="fas fa-network-wired"></i> Networks <span
                class="badge rounded-pill bg-primary" id="networks_num">?</span></a>
          </li>
          <li class="nav-item">
            <a class="nav-link" aria-current="page" href="#volumes" id="nav-volumes-btn" data-bs-toggle="collapse"
              data-bs-target="#navbarCollapse"><i class="fas fa-hdd"></i> Volumes <span
                class="badge rounded-pill bg-primary" id="volumes_num">?</span></a>
          </li>
          <li class="nav-item">
            <a class="nav-link" aria-current="page" href="#registries" id="nav-registries-btn" data-bs-toggle="collapse"
              data-bs-target="#navbarCollapse"><i class="fas fa-cloud"></i> Registries <span
                class="badge rounded-pill bg-primary" id="registries_num">?</span></a>
          </li>
          <li class="nav-item">
            <a class="nav-link" aria-current="page" href="/doc" target="_blank"><i class="fas fa-file-code"></i>
              Apidoc</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <main class="container" id="app">

    <div class="row d-none app" id="info">
      <div class="col-12">
        <div class="row">
          <div class="col-12" id="info-list"></div>
        </div>
        <div class="row">
          <div class="col-12">
            <div class="card">
              <div class="card-header bg-white">
                System Usage
              </div>
              <div class="card-body">
                <div id="system-usage-chart" style="width: 33%; margin: auto;"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="row d-none app" id="containers">
      <div class="col-6 text-center">
        <span id="containers-count" class="text-primary fw-bold">0</span> container(s)
      </div>
      <div class="col-12" id="containers-list"></div>
    </div>

    <div class="row d-none app" id="images">
      <div class="col-6 text-center">
        <span id="images-count" class="text-primary fw-bold">0</span> image(s)
      </div>
      <div class="col-12" id="images-list"></div>
    </div>

    <div class="row d-none app" id="volumes">
      <div class="col-6 text-center">
        <span id="volumes-count" class="text-primary fw-bold">0</span> volume(s)
      </div>
      <div class="col-12" id="volumes-list"></div>
    </div>

    <div class="row d-none app" id="networks">
      <div class="col-6 text-center">
        <span id="networks-count" class="text-primary fw-bold">0</span> network(s)
      </div>
      <div class="col-12" id="networks-list"></div>
    </div>

    <div class="row d-none app" id="registries">
      <div class="col-6 text-center">
        <span id="registries-count" class="text-primary fw-bold">0</span> registries
      </div>
      <div class="col-12" id="registries-list"></div>
    </div>

  </main>

  <footer class="footer w-100 mt-auto py-2">
    <div class="w-100 p-1 text-center text-primary">
      <img src="https://saashup.com/images/saashup_logo_circle.svg" class="rounded-circle" width="32" /> saashup Â© 2024
    </div>
  </footer>

  <script>
    var globalConfig = {};
    var dockerAgent = [];

    $.ajax({
        url: "/api/containers"
      }).done(function (result) {
        dockerAgent["containers"] = result;
        $("#containers_num").text(result.length);
        $.ajax({
          url: "/api/volumes",
        }).done(function (result) {
          dockerAgent["volumes"] = result;
          $("#volumes_num").text(result.Volumes.length);
        });
        $.ajax({
          url: "/api/images",
        }).done(function (result) {
          dockerAgent["images"] = result;
          $("#images_num").text(result.length);
        });
        $.ajax({
          url: "/api/networks",
        }).done(function (result) {
          dockerAgent["networks"] = result;
          $("#networks_num").text(result.length);
        });
        $.ajax({
          url: "/api/registries",
        }).done(function (result) {
          dockerAgent["registries"] = result;
          $("#registries_num").text(result.length);
        });
      })
      .fail(function (result) {
        if (result.status == 403) $('#system-usage-chart').html(
          '<span class="badge bg-danger"><h3>Error</h3></span>');
      });

    function cleanWindow() {
      $(".app").each(function () {
        $(this).addClass('d-none');
      })
      $(".nav-link").each(function () {
        $(this).removeClass('active');
      })
    }

    $("#nav-containers-btn").on('click', function () {
      cleanWindow();
      $('#containers').removeClass('d-none');
      $('#nav-containers-btn').addClass('active');
      location.hash = 'containers';
      $.ajax({
        url: "/api/containers"
      }).done(function (result) {
        dockerAgent["containers"] = result;
        $("#containers_num").text(dockerAgent["containers"].length);
        $("#containers-count").html(dockerAgent["containers"].length);
        let containers = '';
        for (const c of result) {
          let id = c.Id
          containers +=
            '<div class="col-12"><div class="card my-2"><div class="card-header bg-white"><div class="row"><div class="col-8">' +
            c.Name.replace('/', '') + '</div><div class="col-4"><span class="badge rounded-pill bg-' + (c.State
              .Running === true ? "success" : "danger") + '">' + c.State.Status + '</span></div>' +
            '</div></div><div class="card-body row">' +
            '<div class="col-sm-12 col-md-6 text-center">' + c.Id +
            '</div><div class="col-sm-6 col-md-3 text-center">' + c.Created.substring(0, 19).replace('T',
              ' ') +
            '</div><div class="col-sm-6 col-md-3 text-center">' + c.State.StartedAt.substring(0, 19).replace(
              'T',
              ' ') +
            '</div></div><div class="col-12 px-5 text-end"><button class="btn btn-sm btn-success m-2 ' + (c
              .State.Running === false || c.State.Paused === true ? "" : "disabled") +
            '" onclick="startContainer(\'' + id +
            '\');"><i class="fas fa-play"></i> Start</button>' +
            '<button class="btn btn-sm btn-danger m-2 ' + (c.State
              .Running === true ? "" : "disabled") + '" onclick="stopContainer(\'' + id +
            '\');"><i class="fas fa-stop"></i> Stop</button>' +
            '<button class="btn btn-sm btn-info m-2 text-white ' + (c.State
              .Running === true && c.State.Paused === false ? "" : "disabled") +
            '" onclick="pauseContainer(\'' + id +
            '\');"><i class="fas fa-pause"></i> Pause</button>' +
            '<button class="btn btn-sm btn-info m-2 text-white ' + (c.State
              .Paused === true ? "" : "disabled") + '" onclick="unpauseContainer(\'' + id +
            '\');"><i class="fas fa-play"></i> Unpause</button>' +
            '<button class="btn btn-sm btn-danger m-2 ' + (c
              .State.Running === true ? "" : "disabled") + '" onclick="killContainer(\'' + id +
            '\');"><i class="fas fa-skull"></i> Kill</button>' +
            '<button class="btn btn-sm btn-primary m-2" onclick="restartContainer(\'' + id +
            '\');"><i class="fas fa-redo"></i> Restart</button>' +
            '<button class="btn btn-sm btn-warning m-2 text-white ' + (Object.keys(globalConfig).length > 0 ?
              "disabled" : "disabled") +
            '" onclick="recreateContainer();"><i class="fas fa-upload"></i> Recreate</button>' +
            '<button class="btn btn-sm btn-danger m-2 ' + (c.State
              .Running === true ? "disabled" : "") + '" onclick="deleteContainer(\'' + id +
            '\');"><i class="fas fa-trash-alt"></i> Remove</button></div>' +
            '<div class="container">'
          containers += '<ul class="nav"><li class="nav-item"><a href="#cimages_' + id +
            '" class="nav-link px-2 active" data-bs-toggle="tab" id="cimage-tab_' + id + '">Image</a></li>' +
            '<li class="nav-item"><a href="#cports_' + id +
            '" class="nav-link px-2" data-bs-toggle="tab" id="cports-tab_' + id + '">Ports</a></li>' +
            '<li class="nav-item"><a href="#cvolumes_' + id +
            '" class="nav-link px-2" data-bs-toggle="tab" id="cvolumes-tab_' + id + '">Storages</a></li>' +
            '<li class="nav-item"><a href="#cnetwork_' + id +
            '" class="nav-link px-2" data-bs-toggle="tab" id="cnetwork-tab_' + id + '">Network</a></li>' +
            '<li class="nav-item"><a href="#cenv_' + id +
            '" class="nav-link px-2" data-bs-toggle="tab" id="cenv-tab_' + id + '">Env</a></li>' +
            '<li class="nav-item"><a href="#clabels_' + id +
            '" class="nav-link px-2" data-bs-toggle="tab" id="clabels-tab_' + id + '">Labels</a></li>' +
            '<li class="nav-item"><a href="#crestart_' + id +
            '" class="nav-link px-2" data-bs-toggle="tab" id="crestart-tab_' + id + '">Restart</a></li>' +
            '<li class="nav-item"><a href="#ccapabilities_' + id +
            '" class="nav-link px-2" data-bs-toggle="tab" id="ccapabilities-tab_' + id +
            '">Capabilities</a></li>' +
            '<li class="nav-item"><a href="#cresources_' + id +
            '" class="nav-link px-2" data-bs-toggle="tab" id="cresources-tab_' + id + '">Resources</a></li>' +
            '<li class="nav-item"><a href="#chealthcheck_' + id +
            '" class="nav-link px-2" data-bs-toggle="tab" id="chealthcheck-tab_' + id +
            '">Healthcheck</a></li>' +
            '<li class="nav-item"><a href="#csyslog_' + id +
            '" class="nav-link px-2" data-bs-toggle="tab" id="csyslog-tab_' + id +
            '">Logging driver</a></li>' +
            '<li class="nav-item"><a href="#cextras_' + id +
            '" class="nav-link px-2" data-bs-toggle="tab" id="cextras-tab_' + id + '">Extras</a></li>' +
            '<li class="nav-item"><a href="#cexec_' + id +
            '" class="nav-link px-2" data-bs-toggle="tab" id="cexec-tab_' + id + '">Exec</a></li>' +
            '<li class="nav-item"><a href="#cterminal_' + id +
            '" class="nav-link px-2" data-bs-toggle="tab" id="clogs-tab_' + id + '">Terminal</a></li>' +
            '<li class="nav-item"><a href="#clogs_' + id +
            '" class="nav-link px-2" data-bs-toggle="tab" id="clogs-tab_' + id + '" onclick="logs(\'' + id +
            '\');">Logs</a></li>' +
            '</ul></div><div class="tab-content mt-4"><div class="tab-pane fade show active" id="cimages_' +
            id +
            '"><div class="row m-3 align-items-center">' +
            '<div class="col-4"><label class="col-form-label">Image:</label></div><div class="col-8"><input class="form-control" value="' +
            c.Config.Image + '" disabled/></div></div></div>' +
            '<div class="tab-pane fade" id="cports_' + id + '"><div class="row align-items-center">' +
            '<div class="col-12">';
          if (c.HostConfig.PublishAllPorts === true) {
            for (const po of Object.keys(c.NetworkSettings.Ports)) {
              containers +=
                '<div class="row m-2 ports"><div class="col-4"><div class="input-group flex-nowrap"><span class="input-group-text bg-white text-primary">host</span><input class="form-control ports-host" placeholder="name" value="' +
                c.NetworkSettings.Ports[po][0].HostPort +
                '" disabled/></div></div><div class="col-4"><div class="input-group flex-nowrap"><span class="input-group-text bg-white text-primary">container</span><input class="form-control" value="' +
                po.split('/')[0] +
                '" disabled/></div></div><div class="col-2"><input class="form-control" disabled value="' + po
                .split('/')[1] + '"></div></div>'
            }
          } else {
            if ('PortBindings' in c.HostConfig && c.HostConfig.PortBindings !== null && Object.keys(c.HostConfig
                .PortBindings).length > 0) {
              for (const po of Object.keys(c.HostConfig.PortBindings)) {
                containers +=
                  '<div class="row m-2 ports"><div class="col-4"><div class="input-group flex-nowrap"><span class="input-group-text bg-white text-primary">host</span><input class="form-control ports-host" placeholder="name" value="' +
                  (c.HostConfig.PortBindings[po].length > 0 && 'HostPort' in c.HostConfig.PortBindings[po][0] ?
                    c.HostConfig.PortBindings[po][0].HostPort : 0) +
                  '" disabled/></div></div><div class="col-4"><div class="input-group flex-nowrap"><span class="input-group-text bg-white text-primary">container</span><input class="form-control" placeholder="value" value="' +
                  po.split('/')[0] +
                  '" disabled/></div></div><div class="col-2"><input class="form-control" value="' + po.split(
                    '/')[1] + '" disabled></div></div>'
              }
            } else {
              if ('ExposedPorts' in c.Config) {
                for (const po of Object.keys(c.Config.ExposedPorts)) {
                  containers +=
                    '<div class="row m-2 ports"><div class="col-4"><div class="input-group flex-nowrap"><span class="input-group-text bg-white text-primary">host</span><input class="form-control ports-host" placeholder="name" type="number" value="' +
                    po.split('/')[0] +
                    '" disabled/></div></div><div class="col-4"><div class="input-group flex-nowrap"><span class="input-group-text bg-white text-primary">container</span><input class="form-control ports-container" placeholder="value" type="number" value="' +
                    po.split('/')[0] +
                    '" disabled/></div></div><div class="col-2"><input class="form-control ports-proto"value="' +
                    po.split('/')[1] + ' disabled"></div></div>'
                }
              }
            }
          }
          containers += '</div></div></div>' +
            '<div class="tab-pane fade" id="ccommand_' + id + '"><p>Command tab content ...</p></div>' +
            '<div class="tab-pane fade" id="clogging_' + id + '"><p>Logging tab content ...</p></div>' +
            '<div class="tab-pane fade" id="cvolumes_' + id + '"><div class="row align-items-center">' +
            '<div class="col-12">';
          for (const vo of c.Mounts) {
            if (vo.Type === "volume") containers +=
              '<div class="row m-2 volumes"><div class="col-4"><div class="input-group flex-nowrap"><span class="input-group-text bg-white text-primary">volume</span><input class="form-control volume-source" value="' +
              vo.Name +
              '" disabled /></div></div><div class="col-4"><div class="input-group flex-nowrap"><span class="input-group-text bg-white text-primary">container</span><input class="form-control volume-destination" placeholder="value" type="text" value="' +
              vo.Destination +
              '" disabled/></div></div><div class="col-2"><select class="form-control" disabled><option>Volume</option></select></div><div class="col-2"><select class="form-control" disabled><option>' +
              (vo.RW === true ? "RW" : "RO") + '</option></select></div></div>'
          }
          for (const vo of c.Mounts) {
            if (vo.Type !== "volume") containers +=
              '<div class="row m-2 binds"><div class="col-4"><div class="input-group flex-nowrap"><span class="input-group-text bg-white text-primary">host</span><input class="form-control volume-source" placeholder="name" type="text" value="' +
              vo.Source +
              '" disabled/></div></div><div class="col-4"><div class="input-group flex-nowrap"><span class="input-group-text bg-white text-primary">container</span><input class="form-control volume-destination" placeholder="value" type="text" value="' +
              vo.Destination +
              '" disabled/></div></div><div class="col-2"><select class="form-control" disabled><option>Bind</option></select></div><div class="col-2"><select class="form-control" disabled><option>' +
              (vo.RW === true ? "RW" : "RO") + '</option></select></div></div>'
          }
          if (c.HostConfig.Devices !== null) {
            for (const vo of c.HostConfig.Devices) {
              containers +=
                '<div class="row m-2 devices"><div class="col-4"><div class="input-group flex-nowrap"><span class="input-group-text bg-white text-primary">host</span><input class="form-control volume-source" placeholder="name" type="text" value="' +
                vo.PathInContainer +
                '" disabled/></div></div><div class="col-4"><div class="input-group flex-nowrap"><span class="input-group-text bg-white text-primary">container</span><input class="form-control volume-destination" placeholder="value" type="text" value="' +
                vo.PathOnHost +
                '" disabled/></div></div><div class="col-2"><select class="form-control" disabled><option>Device</option></select></div><div class="col-2"><select class="form-control" disabled><option>' +
                (vo.CgroupPermissions === "rwm" ? "RW" : "RO") + '</option></select></div></div>'
            }
          }
          containers += '</div></div></div>' +
            '<div class="tab-pane fade" id="cnetwork_' + id + '"><div class="row m-3 align-items-center">' +
            '<div class="col-4"><label class="col-form-label">Network:</label></div><div class="col-8"><input class="form-control" value="' +
            Object.keys(c.NetworkSettings.Networks)[0] + '" disabled>';
          containers += '</div></div></div>' +
            '<div class="tab-pane fade" id="cenv_' + id + '"><div class="row align-items-center">' +
            '<div class="col-12">';
          for (const e in c.Config.Env) {
            containers += '<div class="row m-2"><div class="col-5">' + c.Config.Env[e].split('=')[0] +
              '</div><div class="col-5"><input class="form-control envvar-value" placeholder="value" type="text" value="' +
              c.Config.Env[e].split('=')[1] + '" disabled/></div></div>'
          }
          containers += '</div></div></div>' +
            '<div class="tab-pane fade" id="clabels_' + id + '"><div class="row align-items-center">' +
            '<div class="col-12">';
          for (const l of Object.keys(c.Config.Labels)) {
            containers += '<div class="row m-2 labels"><div class="col-5">' + l +
              '</div><div class="col-5"><input class="form-control labels-value" placeholder="value" type="text" value="' +
              c.Config.Labels[l] + '" disabled/></div></div>'
          }
          containers += '</div></div></div>' +
            '<div class="tab-pane fade" id="crestart_' + id + '"><div class="row m-3 align-items-center">' +
            '<div class="col-4"><label class="col-form-label">Policy:</label></div><div class="col-8"><input class="form-control" value="' +
            (c.HostConfig.RestartPolicy.Name || 'no') + '" disabled>';
          containers += '</div></div></div>' +
            '<div class="tab-pane fade" id="cruntime_' + id + '"><p>Runtime tab content ...</p></div>' +
            '<div class="tab-pane fade" id="ccapabilities_' + id +
            '"><div class="row m-3 align-items-center">' +
            '<div class="col-4"><label class="col-form-label">Capabilities Added:</label></div><div class="col-8"><input class="form-control" value="' +
            ('CapAdd' in c.HostConfig ? c.HostConfig.CapAdd : "") + '" disabled/></div>' +
            '<div class="col-4 mt-2"><label class="col-form-label">Capabilities Dropped:</label></div><div class="col-8 mt-2"><input class="form-control" value="' +
            ('CapDrop' in c.HostConfig ? c.HostConfig.CapDrop : "") + '" disabled/>';
          containers += '</div></div></div>' +
            '<div class="tab-pane fade" id="csyslog_' + id + '"><div class="row m-3 align-items-center">' +
            '<div class="col-4"><label class="col-form-label">Log Type:</label></div><div class="col-8"><input class="form-control" value="' +
            ('LogConfig' in c.HostConfig ? c.HostConfig.LogConfig.Type : "") + '" disabled/></div></div>' +
            '<div class="row m-3 align-items-center"><div class="col-4"><label class="col-form-label">Log Config:</label></div><div class="col-8"><textarea class="form-control" rows="1" disabled>' +
            ('LogConfig' in c.HostConfig ? JSON.stringify(c.HostConfig.LogConfig.Config) : "") + '</textarea>';
          containers += '</div></div></div>' +
            '<div class="tab-pane fade" id="cresources_' + id + '"><div class="row m-3 align-items-center">' +
            '<div class="col-4"><label class="col-form-label">Memory limit (MB):</label></div><div class="col-8"><input class="form-control" value="' +
            ('Memory' in c.HostConfig ? parseInt(c.HostConfig.Memory) / 1024 / 1024 : "0") + '" disabled/>';
          containers += '</div></div></div>' +
            '<div class="tab-pane fade" id="chealthcheck_' + id + '"><div class="row m-3 align-items-center">' +
            '<div class="col-4 mt-2"><label class="col-form-label">Test:</label></div><div class="col-8"><input class="form-control" value="' +
            ('Healthcheck' in c.Config ? c.Config.Healthcheck.Test : "") + '" disabled/></div>' +
            '<div class="col-4 mt-2"><label class="col-form-label">Interval (ns):</label></div><div class="col-8"><input class="form-control" type="number" value="' +
            ('Healthcheck' in c.Config && 'Interval' in c.Config.Healthcheck ? c.Config.Healthcheck.Interval :
              "0") + '" disabled /></div>' +
            '<div class="col-4 mt-2"><label class="col-form-label">Timeout (ns):</label></div><div class="col-8"><input class="form-control" type="number" value="' +
            ('Healthcheck' in c.Config && 'Timeout' in c.Config.Healthcheck ? c.Config.Healthcheck.Timeout :
              "0") + '" disabled /></div>' +
            '<div class="col-4 mt-2"><label class="col-form-label">Retries (count):</label></div><div class="col-8"><input class="form-control" type="number" value="' +
            ('Healthcheck' in c.Config && 'Retries' in c.Config.Healthcheck ? c.Config.Healthcheck.Retries :
              "0") + '" disabled /></div>' +
            '<div class="col-4 mt-2"><label class="col-form-label">StartPeriod (ns):</label></div><div class="col-8"><input class="form-control" type="number" value="' +
            ('Healthcheck' in c.Config && 'StartPeriod' in c.Config.Healthcheck ? c.Config.Healthcheck
              .StartPeriod : "0") + '" disabled /></div>' +
            '<div class="col-4 mt-2"><label class="col-form-label">StartInterval (ns):</label></div><div class="col-8"><input class="form-control" type="number" value="' +
            ('Healthcheck' in c.Config && 'StartInterval' in c.Config.Healthcheck ? c.Config.Healthcheck
              .StartInterval : "0") + '" disabled /></div>';
          containers += '</div></div>' +
            '<div class="tab-pane fade" id="cextras_' + id + '"><div class="row m-3 align-items-center">' +
            '<div class="col-4"><label class="col-form-label">Pid Mode:</label></div><div class="col-8"><input class="form-control" value="' +
            ('PidMode' in c.HostConfig ? c.HostConfig.PidMode : "") + '" disabled/></div>' +
            '<div class="col-4 mt-2"><label class="col-form-label">Capabilities Dropped:</label></div><div class="col-8 mt-2"><input class="form-control" value="' +
            ('ExtraHosts' in c.HostConfig && c.HostConfig.ExtraHosts != null ? c.HostConfig.ExtraHosts : "") +
            '" disabled/>';
          containers += '</div></div></div>' +
            '<div class="tab-pane fade" id="cexec_' + id + '"><div class="row m-3 align-items-center">' +
            '<div class="col-4"><label class="col-form-label">Command:</label></div><div class="col-8">' +
            '<div class="input-group"><input class="form-control" ' + (c.State.Running === true ? "" :
              "disabled") + '/><button type="button" class="btn btn-primary exec" ' +
            (c.State.Running === true ? "" : "disabled") + '>Exec</button></div>';
          containers += '</div></div></div>' +
            '<div class="tab-pane fade" id="cterminal_' + id + '"><div class="row m-3 align-items-center">' +
            '<div class="col-4"><label class="col-form-label">Shell:</label></div><div class="col-8">' +
            '<div class="input-group"><select class="form-control" ' + (c.State.Running === true ? "" :
              "disabled") +
            '><option value="/bin/bash"/><code>/bin/bash</code></option><option value="/bin/sh"><code>/bin/sh</code></option></select><button type="button" class="btn btn-primary openterm" ' +
            (c.State.Running === true ? "" : "disabled") +
            '>Open</button></div></div></div><div class="terminal"></div>';
          containers += '</div>' +
            '<div class="tab-pane fade" id="clogs_' + id + '"><div class="row m-3 align-items-center">' +
            '<pre id="clogs_' + id +
            '_pre" class="p-2 text-light bg-dark overflow-scroll border border-dark-subtle"></pre>';
          containers += '</div></div>' +
            '</div></div>';
        }
        $('#containers-list').html(containers);
        $('.btn.exec').on('click', (event) => exec(
          $(event.target).parents('.tab-pane').attr('id').split('_')[1],
          event.target.previousElementSibling.value.split(' '),
          $(event.target).parents('.tab-pane')[0],
        ));
        $('.btn.openterm').on('click', (event) => terminal(
          $(event.target).parents('.tab-pane').attr('id').split('_')[1],
          event.target.previousElementSibling.value,
          $(event.target).parent().parent().parent().next().get(0),
        ));
      })
    })

    $("#nav-home-btn").on('click', function () {
      cleanWindow();
      $('#info').removeClass('d-none');
      $('#nav-home-btn').addClass('active')
      location.hash = 'home';
      $.ajax({
        url: "/info",
      }).done(function (result) {
        globalConfig = result;
        info =
          '<div class="col-12"><div class="card my-3"><div class="card-header bg-white"><div class="row"><div class="col-9 text-primary">' +
          result.message + '</div><div class="col-3"><span class="badge rounded-pill bg-' + (
            result.configured === "ok" ? "success" : "danger") + '">' + result.configured +
          '</span></div></div></div><div class="card-body row">' +
          '<div class="col-sm-12 col-md-6 p-2"> <b>OS Kernel</b>: ' + result.docker.KernelVersion +
          '</div><div class="col-sm-12 col-md-6 p-2"> <b>Agent Version</b>: ' + result.version +
          '</div><div class="col-sm-12 col-md-6 p-2"> <b>Docker Api</b>: ' + result.docker.ApiVersion +
          '</div><div class="col-sm-12 col-md-6 p-2"> <b>Storage Driver</b>: ' + ('dockerInfo' in result ?
            result.dockerInfo.Driver : "undefined")
        '</div></div></div></div>';
        $('#info-list').html(info);
      })

      $.ajax({
        url: '/system/usage'
      }).done(function (result) {
        const canvasElt = document.getElementById('system-usage-chart');

        const humanize = (bytes) => {
          if (bytes === 0) return '0 B'
          const sizes = ['B', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB']
          const i = Math.floor(Math.log(bytes) / Math.log(1024))
          const size = (bytes / Math.pow(1024, i)).toFixed(2)
          return `${size} ${sizes[i]}`
        }

        const series = [
          result.layers_size,
          result.images.size,
          result.containers.size_rootfs,
          result.volumes,
          result.build_cache,
        ]
        const chart = new ApexCharts(canvasElt, {
          chart: {
            type: 'donut',
          },
          labels: [
            'Layers',
            'Images',
            'Containers',
            'Volumes',
            'Build Cache',
          ],
          series,
          dataLabels: {
            enabled: true,
            formatter: function (percentage, {
              seriesIndex
            }) {
              const val = series[seriesIndex]
              return humanize(val)
            }
          },
          tooltip: {
            enabled: false
          },
          plotOptions: {
            pie: {
              donut: {
                labels: {
                  show: true,
                  value: {
                    show: true,
                    formatter: function (val) {
                      return humanize(val)
                    }
                  },
                  total: {
                    show: true,
                    showAlways: true,
                    formatter: () => {
                      const total = series.reduce((acc, val) => acc + val, 0)
                      return humanize(total)
                    }
                  }
                }
              }
            }
          }
        })
        chart.render()
      })
    })

    $("#nav-volumes-btn").on('click', function () {
      cleanWindow();
      $('#nav-volumes-btn').addClass('active')
      $('#volumes').removeClass('d-none');
      location.hash = 'volumes';
      $.ajax({
        url: "/api/volumes",
      }).done(function (result) {
        $("#volumes-count").html(result.Volumes.length);
        $("#volumes_num").text(result.Volumes.length);
        let vols = '';
        for (const c of result.Volumes) {
          let used_by = "";
          for (gc in dockerAgent["containers"]) {
            for (const m of dockerAgent["containers"][gc].Mounts)
              if (m.Name === c.Name) used_by += dockerAgent["containers"][gc].Name.replace('/', '') + " "
          }
          vols +=
            '<div class="col-12"><div class="card my-3"><div class="card-header bg-white"><div class="row"><div class="col-9 text-primary">' +
            c.Name +
            '</div></div></div><div class="card-body row"><div class="col-sm-12 col-md-6 p-2"> <b>Created</b>: ' +
            c.CreatedAt.replace('T', ' ').replace('Z', '').substring(0, 19) +
            '</div><div class="col-sm-12 col-md-6 p-2"> <b>Driver</b>: ' + c.Driver +
            '</div><div class="col-sm-12 col-md-12 p-2"> <b>Mountpoint</b>: ' + c.Mountpoint +
            '</div>' +
            '<div class="col-sm-12 col-md-12 p-2"> <b>Used By</b>: <span class="badge rounded-pill bg-primary">' +
            (used_by.split(' ').length - 1) + '</span> ' + used_by + '</div>' +
            '<div class="col-sm-12 col-md-12 p-2"><button class="btn btn-sm btn-danger m-2 ' + (used_by.length >
              0 ? "disabled" : "") + '" onclick="deleteVolume(\'' + c.Name +
            '\');"><i class="fas fa-trash-alt"></i> Remove</button></div></div>' +
            '</div></div></div>';
        }
        $('#volumes-list').html(vols);
      })
    })

    $("#nav-networks-btn").on('click', function () {
      cleanWindow();
      $('#networks').removeClass('d-none');
      $('#nav-networks-btn').addClass('active');
      location.hash = 'networks';
      $.ajax({
        url: "/api/networks",
      }).done(function (result) {
        $("#networks-count").html(result.length)
        $("#networks_num").text(result.length);
        let networks = ''
        for (const c of result) {
          let used_by = "";
          for (gc in dockerAgent["containers"]) {
            if (c.Name in dockerAgent["containers"][gc].NetworkSettings.Networks) used_by += dockerAgent[
                "containers"][gc].Name
              .replace('/', '') + " "
          }
          networks +=
            '<div class="col-12"><div class="card my-3"><div class="card-header bg-white"><div class="row"><div class="col-9 text-primary">' +
            c.Name +
            '</div></div></div><div class="card-body row"><div class="col-sm-12 col-md-6 p-2"> <b>Created</b>: ' +
            c.Created.replace('T', ' ').substring(0, 19) +
            '</div><div class="col-sm-12 col-md-6 p-2"> <b>Driver</b>: ' + c.Driver + '</div>'
          if (c.IPAM.Config !== null && c.IPAM.Config.length > 0) networks +=
            '<div class="col-sm-12 col-md-6 p-2"> <b>IPv4 Subnet</b>: ' + c.IPAM.Config[0].Subnet +
            '</div><div class="col-sm-12 col-md-6 p-2">  <b>IPv4 Subnet</b>: ' + c.IPAM.Config[0].Gateway +
            '</div>' +
            '<div class="col-sm-12 col-md-12 p-2"> <b>Used By</b>: <span class="badge rounded-pill bg-primary">' +
            (used_by.split(' ').length - 1) + '</span> ' + used_by + '</div>' +
            '<div class="col-sm-12 col-md-12 p-2"><button class="btn btn-sm btn-danger m-2 ' + (used_by.length >
              0 ? "disabled" : "") + '" onclick="deleteNetwork(\'' + c.Name +
            '\');"><i class="fas fa-trash-alt"></i> Remove</button></div></div>'
          networks += '</div></div></div>';
        }
        $('#networks-list').html(networks);
      })
    })

    $("#nav-images-btn").on('click', function () {
      cleanWindow();
      $('#images').removeClass('d-none');
      $('#nav-images-btn').addClass('active');
      location.hash = 'images';
      $.ajax({
        url: "/api/images",
      }).done(function (result) {
        $("#images-count").html(result.length)
        $("#images_num").text(result.length);
        let images = ''
        for (const c of result) {
          let used_by = "";
          for (gc in dockerAgent["containers"]) {
            if (dockerAgent["containers"][gc].Image === c.Id) used_by += dockerAgent["containers"][gc].Name
              .replace('/', '') + " "
          }
          images +=
            '<div class="col-12"><div class="card my-2"><div class="card-header bg-white"><div class="row"><div class="col-10 row"><div class="col-9 text-primary">' +
            (c.RepoTags === null || c.RepoTags.length === 0 || c.RepoTags.toString().includes('<none>') ? c.Id :
              c.RepoTags[0]) +
            '</div></div></div></div><div class="card-body row"><div class="col-sm-12 col-md-6 p-2"> <b>Created</b>: ' +
            new Date(c.Created * 1000).toISOString().substring(0, 19).replace('T', ' ') +
            '</div><div class="col-sm-12 col-md-6 p-2"> <b>Size</b>: ' + (c.Size / 1024 / 1024).toFixed(2) +
            'MB</div><div class="col-sm-12 col-md-12 p-2"> <b>Id</b>: ' + c.Id + '</div>' +
            '<div class="col-sm-12 col-md-12 p-2"> <b>Digest</b>: ' + (c.RepoDigests[0] ? c.RepoDigests[0]
              .split("@")[0] : "none") + '</div>' +
            '<div class="col-sm-12 col-md-12 p-2"> <b>Used By</b>: <span class="badge rounded-pill bg-primary">' +
            (used_by.split(' ').length - 1) + '</span> ' + used_by + '</div>' +
            '<div class="col-sm-12 col-md-12 p-2"><button class="btn btn-sm btn-warning m-2 ' + (c.RepoTags[
              0] && c.RepoDigests[0] ? "" : "disabled") + '" onclick="pullImage(\'' + c.Id +
            '\', \'' + (c.RepoTags[0] ? c.RepoTags[0].split(':')[0] : "") + '\', \'' + (c.RepoTags[0] ? c
              .RepoTags[0].split(':')[1] : "") + '\', \'' + Math.ceil(c.Size / 1024 / 1024) +
            '\');"><i class="fas fa-arrow-down"></i> Pull</button><button class="btn btn-sm btn-danger m-2 ' + (
              used_by.length > 0 ? "disabled" : "") + '" onclick="deleteImage(\'' + c.Id +
            '\');"><i class="fas fa-trash-alt"></i> Remove</button></div></div>' +
            '</div></div></div>'
        }
        $('#images-list').html(images);
      })
    })

    function deleteNetwork(id) {
      $("#modalNotificationTitle").html("Delete network");
      $("#modalNotificationContent").html('Pls wait ! Deletion is ongoing.... ');
      $("#modalNotification").modal("show");
      $.ajax({
        url: "/api/engine/networks",
        method: "DELETE",
        data: {
          "data": {
            "name": id
          }
        },
        dataType: "json"
      }).done(function (result) {
        setTimeout(function () {
          $("#modalNotification").modal("hide");
          $("#nav-networks-btn").click();
        }, 2000)
      })
    }

    function deleteVolume(id) {
      $("#modalNotificationTitle").html("Delete volume");
      $("#modalNotificationContent").html('Pls wait ! Deletion is ongoing.... ');
      $("#modalNotification").modal("show");
      $.ajax({
        url: "/api/engine/volumes",
        method: "DELETE",
        data: {
          "data": {
            "name": id
          }
        },
        dataType: "json"
      }).done(function (result) {
        setTimeout(function () {
          $("#modalNotification").modal("hide");
          $("#nav-volumes-btn").click();
        }, 2000)
      })
    }

    function pullImage(id, name, version, size) {
      $("#modalNotificationTitle").html("Pulling image");
      $("#modalNotificationContent").html('Pls wait ! Image is being pulled.... ');
      $("#modalNotification").modal("show");
      $.ajax({
        url: "/api/engine/images",
        method: "POST",
        data: JSON.stringify({
          "data": {
            "name": name,
            "version": version,
            "size": parseInt(size),
            "ImageID": id,
            "force": true
          }
        }),
        contentType: "application/json; charset=utf-8",
        dataType: "json"
      }).done(function (result) {
        setTimeout(function () {
          $("#modalNotification").modal("hide");
          $("#nav-images-btn").click();
        }, 5000)
      })
    }

    function deleteImage(id) {
      $("#modalNotificationTitle").html("Delete image");
      $("#modalNotificationContent").html('Pls wait ! Deletion is ongoing.... ');
      $("#modalNotification").modal("show");
      $.ajax({
        url: "/api/engine/images",
        method: "DELETE",
        data: {
          "data": {
            "ImageID": id
          }
        },
        dataType: "json"
      }).done(function (result) {
        setTimeout(function () {
          $("#modalNotification").modal("hide");
          $("#nav-images-btn").click();
        }, 2000)
      })
    }

    function actionContainer(id, action) {
      $("#modalNotificationTitle").html("Operation " + action);
      $("#modalNotificationContent").html('Pls wait ! ' + action + ' is ongoing.... ');
      $("#modalNotification").modal("show");
      $.ajax({
        url: "/api/engine/containers",
        method: "PUT",
        data: {
          "data": {
            "operation": action,
            "ContainerID": id
          }
        },
        dataType: "json"
      }).done(function (result) {
        setTimeout(function () {
          $("#modalNotification").modal("hide");
          $("#nav-containers-btn").click();
        }, 5000)
      })
    }

    function recreateContainer(id) {
      //on going work
      return;
      $("#modalNotificationTitle").html("operation recreate");
      $("#modalNotificationContent").html('Pls wait ! recreate is ongoing.... ');
      $("#modalNotification").modal("show");
      let container = {}
      for (const c of dockerAgent["containers"]) {
        if (c.Id = id) {
          container = c;
          break;
        }
      }
      $.ajax({
        url: "/api/engine/containers",
        method: "PUT",
        data: {
          "data": {
            "id": id,
            "host": {
              "id": globalConfig.config.id,
            },
            "image": {
              "ImageID": c.Image
            },
            "name": c.Name.replace("/", ""),
            "operation": "recreate",
            "ContainerID": c.Id,
            "hostname": c.Config.Hostname,
            "restart_policy": c.HostConfig.RestartPolicy.Name,
            "cap_add": c.HostConfig.CapAdd,
            "cap_drop": c.HostConfig.CapDrop,
            "ports": [{
              "public_port": 0,
              "private_port": 1880,
              "type": "tcp"
            }],
            "env": [{
              "var_name": "NODE_VERSION",
              "value": "18.18.0"
            }, {
              "var_name": "PATH",
              "value": "/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"
            }, {
              "var_name": "PORT",
              "value": "1880"
            }, {
              "var_name": "YARN_VERSION",
              "value": "1.22.19"
            }],
            "labels": [{
              "key": "test",
              "value": "test"
            }],
            "mounts": [],
            "binds": [],
            "network_settings": [{
              "network": {
                "id": 279,
                "url": "/api/plugins/docker/networks/279/",
                "display": "bridge",
                "name": "bridge",
                "driver": "bridge",
                "NetworkID": "9583f95bf910908823d06dfe48e7585a8a2fcceced0e3a61133f6f4e43198e28",
                "state": "created"
              }
            }],
            "devices": [{
              "host_path": "/dev/net/tun",
              "container_path": "/dev/net/tun"
            }]
          }
        },
        dataType: "json"
      }).done(function (result) {
        setTimeout(function () {
          $("#modalNotification").modal("hide");
          $("#nav-containers-btn").click();
        }, 5000)
      })
    }

    function deleteContainer(id) {
      $("#modalNotificationTitle").html("operation delete");
      $("#modalNotificationContent").html('Pls wait ! delete is ongoing.... ');
      $("#modalNotification").modal("show");
      $.ajax({
        url: "/api/engine/containers",
        method: "DELETE",
        data: {
          "data": {
            "host": {
              "state": "stopped"
            },
            "ContainerID": id
          }
        },
        dataType: "json"
      }).done(function (result) {
        setTimeout(function () {
          $("#modalNotification").modal("hide");
          $("#nav-containers-btn").click();
        }, 5000)
      })
    }

    function stopContainer(name) {
      actionContainer(name, "stop")
    }

    function startContainer(name) {
      actionContainer(name, "start")
    }

    function restartContainer(name) {
      actionContainer(name, "restart")
    }

    function killContainer(name) {
      actionContainer(name, "kill")
    }

    function pauseContainer(name) {
      actionContainer(name, "pause")
    }

    function unpauseContainer(name) {
      actionContainer(name, "unpause")
    }

    const exec = (containerId, cmd, elemOutput) => {
      if (cmd.length > 0 && cmd[0].length > 0) {
        $.ajax({
          method: "PUT",
          url: `/api/engine/containers/${containerId}/exec`,
          data: {
            cmd: cmd
          },
          dataType: "json"
        }).done(result => {
          $(elemOutput).children('pre').remove();

          const pre = document.createElement('pre');
          pre.classList.add('p-2', 'text-light', 'bg-dark', 'overflow-scroll', 'border', 'border-dark-subtle');
          pre.appendChild(document.createTextNode(result.stdout));
          elemOutput.appendChild(pre);
        });
      }
    }

    const terminal = (containerId, cmd, elemTerminal) => {
      let alert = elemTerminal.nextElementSibling;
      if (alert !== null) {
        alert.remove();
      }

      if (elemTerminal.children.length > 0) {
        return;
      }

      $.ajax({
        method: "POST",
        url: `/api/engine/containers/${containerId}/ws`,
        dataType: "json"
      }).done(result => {
        let url = new URL(window.location.origin);
        url.protocol = url.protocol == "https" ? "wss" : "ws";

        let client = new DockerExecWebsocketClient({
          url: url.toString().slice(0, -1) + result.path,
          tty: true,
          command: [cmd],
        });
        client.execute();

        elemTerminal.classList.add("p-2");
        elemTerminal.style.backgroundColor = "#2D2E2C";
        elemTerminal.style.borderRadius = "0 0 .25rem .25rem"

        let baseTheme = {
          foreground: '#F8F8F8',
          background: '#2D2E2C',
          selection: '#5DA5D533',
          black: '#1E1E1D',
          brightBlack: '#262625',
          red: '#CE5C5C',
          brightRed: '#FF7272',
          green: '#5BCC5B',
          brightGreen: '#72FF72',
          yellow: '#CCCC5B',
          brightYellow: '#FFFF72',
          blue: '#5D5DD3',
          brightBlue: '#7279FF',
          magenta: '#BC5ED1',
          brightMagenta: '#E572FF',
          cyan: '#5DA5D5',
          brightCyan: '#72F0FF',
          white: '#F8F8F8',
          brightWhite: '#FFFFFF'
        };

        let term = new Terminal({
          theme: baseTheme,
          cursorBlink: true
        });

        term.open(elemTerminal);

        term.onData(e => {
          client.stdin.write(e);
        });

        client.stdout.on('data', function (data) {
          term.write(String.fromCharCode.apply(null, data));
        });

        client.stderr.on('data', function (data) {
          term.write(String.fromCharCode.apply(null, data));
        });

        client.on("exit", e => {
          destroyTerminal(term, elemTerminal);
        });

        client.on("shutdown", e => {
          destroyTerminal(term, elemTerminal);
        });
      }).fail(error => {
        let div = document.createElement("div");
        div.classList.add("alert", "alert-danger", "row", "m-4");
        div.appendChild(document.createTextNode(error.responseJSON.message));
        elemTerminal.after(div);
      });
    }

    const destroyTerminal = (term, elemTerminal) => {
      elemTerminal.classList.remove("p-2");
      elemTerminal.style = null;
      term.dispose();
    }

    const logs = (containerId) => {
      $.ajax({
        method: "GET",
        url: `/api/engine/containers/${containerId}/logs`
      }).done(result => {
        $("#clogs_" + containerId + "_pre").html(result.toString().replace(/(?:\r\n|\r|\n)/g, '<br>'))
      });
    }

    $("#nav-registries-btn").on('click', function () {
      cleanWindow();
      $('#nav-registries-btn').addClass('active')
      $('#registries').removeClass('d-none');
      location.hash = 'registries';
      const list = document.getElementById("registries-list");
      while (list.firstChild) {
        list.removeChild(list.lastChild);
      }

      $.ajax({
        url: "/api/registries",
      }).done(function (result) {
        $("#registries-count").html(result.length);
        $("#registries_num").text(result.length);
        if (dockerAgent["images"]) {
          for (const d of dockerAgent["images"]) {
            d.registry = false;
          }
        }
        for (const c of result) {
          const card = document.createElement("div");
          card.classList.add("card", "my-2");

          const header = document.createElement("div");
          header.appendChild(document.createTextNode(c.name));
          header.classList.add("card-header", "bg-white", "text-primary");

          card.appendChild(header);

          const body = document.createElement("div");
          body.classList.add("card-body", "row");

          const serveraddress = document.createElement("div");
          serveraddress.classList.add("col-md-12", "col-sm-12", "p-2");

          const serveraddressHead = document.createElement("b");
          serveraddressHead.appendChild(document.createTextNode("serveraddress: "));

          const serveraddressContent = document.createElement("code");
          serveraddressContent.appendChild(document.createTextNode(c.serveraddress));

          serveraddress.appendChild(serveraddressHead)
          serveraddress.appendChild(serveraddressContent);

          body.appendChild(serveraddress);

          const images = document.createElement("div");
          images.classList.add("col-md-12", "col-sm-12", "p-2");

          const imageHead = document.createElement("b");
          imageHead.appendChild(document.createTextNode("Image(s) count: "));

          const imageContent = document.createElement("span");
          imageContent.appendChild(document.createTextNode(c.images.length));
          imageContent.classList.add("badge", "rounded-pill", "bg-primary");

          images.appendChild(imageHead)
          images.appendChild(imageContent);

          body.appendChild(images);

          const imagesList = document.createElement("div");
          imagesList.classList.add("col-md-12", "col-sm-12", "p-2");

          const imagesListHead = document.createElement("b");
          imagesListHead.appendChild(document.createTextNode("Image(s) list: "));

          const imagesListContent = document.createElement("span");

          let s = "";
          for (const i of c.images) {
            let valid = '<span class="badge rounded-pill bg-danger">failed</span>';
            if (dockerAgent["images"]) {
              for (const d of dockerAgent["images"]) {
                if (d.RepoTags[0] === i) {
                  valid = '<span class="badge rounded-pill bg-success">success</span>';
                  d.registry = true;
                  break;
                }
                if (d.RepoDigests[0] === i) {
                  valid = '<span class="badge rounded-pill bg-success">success</span>';
                  d.registry = true;
                  break;
                }
                if (d.Id === i.split("@")[1]) {
                  valid = '<span class="badge rounded-pill bg-success">success</span>';
                  d.registry = true;
                  break;
                }
              }
            } else valid = '<span class="badge rounded-pill bg-warning">unknown</span>';
            s += '<br>' + valid + " " + i;
          }
          imagesListContent.innerHTML = s;

          imagesList.appendChild(imagesListHead)
          imagesList.appendChild(imagesListContent);
          imagesList.appendChild(imagesListContent);

          body.appendChild(imagesList);

          card.appendChild(body);
          list.appendChild(card);
        }

        let s = "";
        let count = 0;
        if (dockerAgent["images"]) {
          for (const d of dockerAgent["images"]) {
            if (d.registry === false) {
              if (d.RepoTags.length >0) s += '<br><span class="badge rounded-pill bg-danger">error</span> ' + d.RepoTags[0];
              else s += '<br><span class="badge rounded-pill bg-danger">error</span> ' + d.RepoDigests[0];
              count++;
            }
          }
        }

        const card = document.createElement("div");
        card.classList.add("card", "my-2");

        const header = document.createElement("div");
        header.appendChild(document.createTextNode("no registry"));
        header.classList.add("card-header", "bg-white", "text-primary");

        card.appendChild(header);

        const body = document.createElement("div");
        body.classList.add("card-body", "row");

        const images = document.createElement("div");
        images.classList.add("col-md-12", "col-sm-12", "p-2");

        const imageHead = document.createElement("b");
        imageHead.appendChild(document.createTextNode("Image(s) count: "));

        const imageContent = document.createElement("span");
        imageContent.appendChild(document.createTextNode(count));
        if (count > 0) imageContent.classList.add("badge", "rounded-pill", "bg-danger");
        else imageContent.classList.add("badge", "rounded-pill", "bg-primary");

        images.appendChild(imageHead)
        images.appendChild(imageContent);

        body.appendChild(images);

        const imagesList = document.createElement("div");
        imagesList.classList.add("col-md-12", "col-sm-12", "p-2");

        const imagesListHead = document.createElement("b");
        imagesListHead.appendChild(document.createTextNode("Image(s) list: "));

        const imagesListContent = document.createElement("span");

        imagesListContent.innerHTML = s;
        imagesList.appendChild(imagesListHead)
        imagesList.appendChild(imagesListContent);
        imagesList.appendChild(imagesListContent);
        body.appendChild(imagesList);
        card.appendChild(body);
        list.appendChild(card);
      })
    });

    switch (window.location.hash) {
      case '#containers':
        $("#nav-containers-btn").click();
        break;
      case '#volumes':
        $("#nav-volumes-btn").click();
        break;
      case '#networks':
        $("#nav-networks-btn").click();
        break;
      case '#images':
        $("#nav-images-btn").click();
        break;
      case '#registries':
        $("#nav-registries-btn").click();
        break;
      default:
        $("#nav-home-btn").click();
    }
  </script>

</body>

</html>