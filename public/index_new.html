<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.15.1/dist/cdn.min.js"
        integrity="sha384-1P3ccpD4L/9t6HWl43VEHcYRLuA3zlADdXoOEnvQOsZHH6caGISdjzrMQOBr4M4T"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@xterm/xterm@5.5.0/lib/xterm.min.js"
        integrity="sha384-J4qzUjBl1FxyLsl/kQPQIOeINsmp17OHYXDOMpMxlKX53ZfYsL+aWHpgArvOuof9"
        crossorigin="anonymous"></script>
    <script src="/js/docker-exec-client.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css"
        integrity="sha384-CK2SzKma4jA5H/MXDUU7i1TqZlCFaD4T01vtyDFvPlD97JQyS+IsSh1nI2EFbpyk" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@xterm/xterm@5.5.0/css/xterm.min.css"
        integrity="sha384-tStR1zLfWgsiXCF3IgfB3lBa8KmBe/lG287CL9WCeKgQYcp1bjb4/+mwN6oti4Co" crossorigin="anonymous">
    <link rel="icon" href="https://saashup.com/img/logo_saashup.png">
    <title>Netbox Docker Agent</title>
</head>

<body x-data="{
    async init() {
        const response = await fetch('/api/containers');
        this.containers = await response.json();
    },
    containers: []
}">
    <div class="container">
        <template x-if="containers.length > 0">
            <template x-for="container in containers">
                <div class="card mb-3">
                    <div class="card-header d-flex justify-content-between align-items-start">
                        <span x-text="container.Name.replace('/', '')"></span>
                        <span class="badge rounded-pill"
                            :class="container.State.Running === true ? 'text-bg-success' : 'text-bg-warning'"
                            x-text="container.State.Status"></span>
                    </div>
                    <div class="card-body">
                        <!-- Action buttons -->
                        <div class="row">
                            <div class="col-auto mb-1">
                                <button class="btn btn-sm btn-success text-nowrap"
                                    :disabled="container.State.Running === true && container.State.Paused === false"><i
                                        class="bi bi-play-fill"></i> Start</button>
                            </div>
                            <div class="col-auto mb-1">
                                <button class="btn btn-sm btn-danger text-nowrap"
                                    :disabled="container.State.Running === false"><i class="bi bi-stop-fill"></i>
                                    Stop</button>
                            </div>
                            <div class="col-auto mb-1"><button class="btn btn-sm btn-info text-nowrap"
                                    :disabled="container.State.Running === false || container.State.Paused === true"><i
                                        class="bi bi-pause-fill"></i> Pause</button></div>
                            <div class="col-auto mb-1"><button class="btn btn-sm btn-info text-nowrap"
                                    :disabled="container.State.Paused === false"><i class="bi bi-play"></i>
                                    Unpause</button></div>
                            <div class="col-auto mb-1"><button class="btn btn-sm btn-dark text-nowrap"
                                    :disabled="container.State.Running === false"><i class="bi bi-heartbreak-fill"></i>
                                    Kill</button>
                            </div>
                            <div class="col-auto mb-1"><button class="btn btn-sm btn-primary text-nowrap"><i
                                        class="bi bi-arrow-clockwise"></i> Restart</button></div>
                            <div class="col-auto"><button class="btn btn-sm btn-warning"><i class="bi bi-recycle"></i>
                                    Recreate</button>
                            </div>
                            <div class="col-auto mb-1"><button class="btn btn-sm btn-danger text-nowrap"
                                    :disabled="container.State.Running === true"><i class="bi bi-trash-fill"></i>
                                    Remove</button>
                            </div>
                        </div>

                        <hr>

                        <!-- Id and dates -->
                        <dl class="row">
                            <dt class="col-sm-1">Id</dt>
                            <dd class="col-sm-11">
                                <code title="Id" x-text="container.Id"></code>
                            </dd>

                            <dt class="col-sm-1">Created at</dt>
                            <dd class="col-sm-11">
                                <time title="Created at" x-text="(new Date(container.Created))"></time>
                            </dd>

                            <dt class="col-sm-1">Started at</dt>
                            <dd class="col-sm-11"><time title="Started at"
                                    x-text="(new Date(container.State.StartedAt))"></time></dd>
                        </dl>

                        <hr>

                        <ul class="nav nav-underline card-body-tabs mb-3" :id="`container-${container.Id}`"
                            role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" :id="`image-tab-${container.Id}`" data-bs-toggle="tab"
                                    :data-bs-target="`#image-tab-pane-${container.Id}`" type="button" role="tab"
                                    :aria-controls="`image-tab-pane-${container.Id}`"
                                    aria-selected="true">Image</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" :id="`ports-tab-${container.Id}`" data-bs-toggle="tab"
                                    :data-bs-target="`#ports-tab-pane-${container.Id}`" type="button" role="tab"
                                    :aria-controls="`ports-tab-pane-${container.Id}`">Ports</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" :id="`storages-tab-${container.Id}`" data-bs-toggle="tab"
                                    :data-bs-target="`#storages-tab-pane-${container.Id}`" type="button" role="tab"
                                    :aria-controls="`storages-tab-pane-${container.Id}`">Storages</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" :id="`network-tab-${container.Id}`" data-bs-toggle="tab"
                                    :data-bs-target="`#network-tab-pane-${container.Id}`" type="button" role="tab"
                                    :aria-controls="`network-tab-pane-${container.Id}`">Network</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" :id="`env-tab-${container.Id}`" data-bs-toggle="tab"
                                    :data-bs-target="`#env-tab-pane-${container.Id}`" type="button" role="tab"
                                    :aria-controls="`env-tab-pane-${container.Id}`">Env</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" :id="`command-tab-${container.Id}`" data-bs-toggle="tab"
                                    :data-bs-target="`#command-tab-pane-${container.Id}`" type="button" role="tab"
                                    :aria-controls="`command-tab-pane-${container.Id}`">Command</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" :id="`labels-tab-${container.Id}`" data-bs-toggle="tab"
                                    :data-bs-target="`#labels-tab-pane-${container.Id}`" type="button" role="tab"
                                    :aria-controls="`labels-tab-pane-${container.Id}`">Labels</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" :id="`restart-tab-${container.Id}`" data-bs-toggle="tab"
                                    :data-bs-target="`#restart-tab-pane-${container.Id}`" type="button" role="tab"
                                    :aria-controls="`restart-tab-pane-${container.Id}`">Restart</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" :id="`capabilities-tab-${container.Id}`" data-bs-toggle="tab"
                                    :data-bs-target="`#capabilities-tab-pane-${container.Id}`" type="button" role="tab"
                                    :aria-controls="`capabilities-tab-pane-${container.Id}`">Capabilities</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" :id="`resources-tab-${container.Id}`" data-bs-toggle="tab"
                                    :data-bs-target="`#resources-tab-pane-${container.Id}`" type="button" role="tab"
                                    :aria-controls="`resources-tab-pane-${container.Id}`">Resources</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" :id="`healthcheck-tab-${container.Id}`" data-bs-toggle="tab"
                                    :data-bs-target="`#healthcheck-tab-pane-${container.Id}`" type="button" role="tab"
                                    :aria-controls="`healthcheck-tab-pane-${container.Id}`">Healthcheck</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" :id="`logging-driver-tab-${container.Id}`" data-bs-toggle="tab"
                                    :data-bs-target="`#logging-driver-tab-pane-${container.Id}`" type="button"
                                    role="tab" :aria-controls="`logging-driver-tab-pane-${container.Id}`">Logging
                                    driver</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" :id="`extras-tab-${container.Id}`" data-bs-toggle="tab"
                                    :data-bs-target="`#extras-tab-pane-${container.Id}`" type="button" role="tab"
                                    :aria-controls="`extras-tab-pane-${container.Id}`">Extras</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" :id="`exec-tab-${container.Id}`" data-bs-toggle="tab"
                                    :data-bs-target="`#exec-tab-pane-${container.Id}`" type="button" role="tab"
                                    :aria-controls="`exec-tab-pane-${container.Id}`">Exec</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" :id="`terminal-tab-${container.Id}`" data-bs-toggle="tab"
                                    :data-bs-target="`#terminal-tab-pane-${container.Id}`" type="button" role="tab"
                                    :aria-controls="`terminal-tab-pane-${container.Id}`">Terminal</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" :id="`logs-tab-${container.Id}`" data-bs-toggle="tab"
                                    :data-bs-target="`#logs-tab-pane-${container.Id}`" type="button" role="tab"
                                    :aria-controls="`logs-tab-pane-${container.Id}`"
                                    @click="$dispatch('get-logs', { id: container.Id })">Logs</button>
                            </li>
                        </ul>
                        <div class="tab-content" :id="`content-container-${container.Id}`">
                            <!-- Image name -->
                            <div class="tab-pane fade show active" :id="`image-tab-pane-${container.Id}`"
                                role="tabpanel" :aria-labelledby="`image-tab-${container.Id}`" tabindex="0">
                                <dl class="row">
                                    <dt class="col-auto">Image</dt>
                                    <dd class="col" x-data="{ copied: false }">
                                        <code x-text="container.Config.Image"></code>
                                        <button title="Copy to clipboard" class="align-bottom btn btn-sm p-0"
                                            @click="navigator.clipboard.writeText(container.Config.Image); copied = true; setTimeout(() => copied = false, 3000)"><i
                                                class="bi"
                                                :class="copied ? 'bi-check-lg' : 'bi-clipboard'"></i></button>
                                    </dd>
                                </dl>
                            </div>
                            <!-- Ports mapping -->
                            <div class="tab-pane fade" :id="`ports-tab-pane-${container.Id}`" role="tabpanel"
                                :aria-labelledby="`ports-tab-${container.Id}`" tabindex="0">
                                <template x-if="container.HostConfig.PublishAllPorts === true">
                                    <table class="table">
                                        <thead>
                                            <tr>
                                                <th>Host</th>
                                                <th>Container</th>
                                                <th>Protocol</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <template x-for="po of Object.keys(container.NetworkSettings.Ports)">
                                                <tr>
                                                    <td
                                                        x-text="(container.HostConfig.PortBindings[po].length > 0 && 'HostPort' in container.HostConfig.PortBindings[po][0] ? container.HostConfig.PortBindings[po][0].HostPort : 0)">
                                                    </td>
                                                    <td x-text="po.split('/')[0]"></td>
                                                    <td x-text="po.split('/')[1].toUpperCase()"></td>
                                                </tr>
                                            </template>
                                        </tbody>
                                    </table>
                                </template>
                                <template
                                    x-if="!(container.HostConfig.PublishAllPorts === true) && ('PortBindings' in container.HostConfig && container.HostConfig.PortBindings !== null && Object.keys(container.HostConfig.PortBindings).length > 0)">
                                    <table class="table">
                                        <thead>
                                            <tr>
                                                <th>Host</th>
                                                <th>Container</th>
                                                <th>Protocol</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <template x-for="po of Object.keys(container.HostConfig.PortBindings)">
                                                <tr>
                                                    <td
                                                        x-text="(container.HostConfig.PortBindings[po].length > 0 && 'HostPort' in container.HostConfig.PortBindings[po][0] ? container.HostConfig.PortBindings[po][0].HostPort : 0)">
                                                    </td>
                                                    <td x-text="po.split('/')[0]"></td>
                                                    <td x-text="po.split('/')[1].toUpperCase()"></td>
                                                </tr>
                                            </template>
                                        </tbody>
                                    </table>
                                </template>
                                <template
                                    x-if="!(!(container.HostConfig.PublishAllPorts === true) && ('PortBindings' in container.HostConfig && container.HostConfig.PortBindings !== null && Object.keys(container.HostConfig.PortBindings).length > 0)) && 'ExposedPorts' in container.Config">
                                    <table class="table">
                                        <thead>
                                            <tr>
                                                <th>Host</th>
                                                <th>Container</th>
                                                <th>Protocol</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <template x-for="po of Object.keys(container.Config.ExposedPorts)">
                                                <tr>
                                                    <td x-text="po.split('/')[0]"></td>
                                                    <td x-text="po.split('/')[0]"></td>
                                                    <td x-text="po.split('/')[1].toUpperCase()"></td>
                                                </tr>
                                            </template>
                                        </tbody>
                                    </table>
                                </template>
                                <template
                                    x-if="!(!(container.HostConfig.PublishAllPorts === true) && ('PortBindings' in container.HostConfig && container.HostConfig.PortBindings !== null && Object.keys(container.HostConfig.PortBindings).length > 0)) && !('ExposedPorts' in container.Config)">
                                    <p>No ports mapping</p>
                                </template>
                            </div>
                            <!-- Mounts -->
                            <div class="tab-pane fade" :id="`storages-tab-pane-${container.Id}`" role="tabpanel"
                                :aria-labelledby="`storages-tab-${container.Id}`" tabindex="0">
                                <template
                                    x-if="container.Mounts.length > 0 || (container.HostConfig.Devices !== null && container.HostConfig.Devices.length > 0)">
                                    <table class="table">
                                        <thead>
                                            <tr>
                                                <th>Type</th>
                                                <th>Host</th>
                                                <th>Container</th>
                                                <th>Mode</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <template x-if="container.Mounts.length > 0">
                                                <template x-for="vo of container.Mounts">
                                                    <tr>
                                                        <td x-text="vo.Type === 'volume' ? 'Volume' : 'Bind'"></td>
                                                        <td><code
                                                                x-text="vo.Type === 'volume' ? vo.Name : vo.Source"></code>
                                                        </td>
                                                        <td><code x-text="vo.Destination"></code></td>
                                                        <td x-text="vo.RW === true ? 'Read/Write' : 'Read only'"></td>
                                                    </tr>
                                                </template>
                                            </template>
                                            <template x-if="container.HostConfig.Devices !== null">
                                                <template x-for="const vo of container.HostConfig.Devices">
                                                    <tr>
                                                        <td x-text="'Device'"></td>
                                                        <td><code x-text="vo.PathInContainer"></code></td>
                                                        <td><code x-text="vo.PathOnHost"></code></td>
                                                        <td
                                                            x-text="vo.CgroupPermissions === 'rwm' ? 'Read/Write' : 'Read only'">
                                                        </td>
                                                    </tr>
                                                </template>
                                            </template>
                                        </tbody>
                                    </table>
                                </template>
                                <template
                                    x-if="container.Mounts.length == 0 && (container.HostConfig.Devices === null || container.HostConfig.Devices.length === 0)">
                                    <p>No storage</p>
                                </template>
                            </div>
                            <!-- Network -->
                            <div class="tab-pane fade" :id="`network-tab-pane-${container.Id}`" role="tabpanel"
                                :aria-labelledby="`network-tab-${container.Id}`" tabindex="0">
                                <dl class="row">
                                    <dt class="col-auto">Network</dt>
                                    <dd class="col"><code
                                            x-text="Object.keys(container.NetworkSettings.Networks)[0]"></code>
                                    </dd>
                                </dl>
                            </div>
                            <!-- Environment variables -->
                            <div class="tab-pane fade" :id="`env-tab-pane-${container.Id}`" role="tabpanel"
                                :aria-labelledby="`env-tab-${container.Id}`" tabindex="0">
                                <template x-if="container.Config.Env.length > 0">
                                    <template x-for="e of container.Config.Env">
                                        <dl class="row border-bottom justify-content-start mb-1"
                                            x-data="{ key: e.split('=')[0], value: e.split('=')[1] }">
                                            <dt class="col-auto text-nowrap"><code class="text-reset"
                                                    x-text="key"></code>
                                            </dt>
                                            <dd class="col">
                                                <template x-if="value.length > 0">
                                                    <code x-text="value"></code>
                                                </template>
                                                <template x-if="value.length === 0">
                                                    <code><i class="bi bi-patch-minus" title="Empty value"></i></code>
                                                </template>
                                            </dd>
                                        </dl>
                                    </template>
                                </template>
                            </div>
                            <!-- Command -->
                            <div class=" tab-pane fade" :id="`command-tab-pane-${container.Id}`" role="tabpanel"
                                :aria-labelledby="`command-tab-${container.Id}`" tabindex="0">
                                <dl class="row">
                                    <dt class="col-auto">Command</dt>
                                    <dd class="col">
                                        <template x-if="container.Config.Cmd === null">
                                            <code><i class="bi bi-patch-minus" title="Empty value"></i></code>
                                        </template>
                                        <template x-if="container.Config.Cmd !== null">
                                            <code x-text="container.Config.Cmd.join(' ')"></code>
                                        </template>
                                    </dd>
                                </dl>
                            </div>
                            <!-- Labels -->
                            <div class="tab-pane fade" :id="`labels-tab-pane-${container.Id}`" role="tabpanel"
                                :aria-labelledby="`labels-tab-${container.Id}`" tabindex="0">
                                <template x-if="Object.entries(container.Config.Labels).length > 0">
                                    <template x-for="[key, value] of Object.entries(container.Config.Labels)">
                                        <dl class="row border-bottom justify-content-start mb-1">
                                            <dt class="col-auto text-nowrap"><code class="text-reset"
                                                    x-text="key"></code>
                                            </dt>
                                            <dd class="col">
                                                <template x-if="value.length > 0">
                                                    <code x-text="value"></code>
                                                </template>
                                                <template x-if="value.length === 0">
                                                    <code><i class="bi bi-patch-minus" title="Empty value"></i></code>
                                                </template>
                                            </dd>
                                        </dl>
                                    </template>
                                </template>
                                <template x-if="Object.entries(container.Config.Labels).length === 0">
                                    <p>No label</p>
                                </template>
                            </div>
                            <!-- Restart policy -->
                            <div class="tab-pane fade" :id="`restart-tab-pane-${container.Id}`" role="tabpanel"
                                :aria-labelledby="`restart-tab-${container.Id}`" tabindex="0">
                                <dl class="row">
                                    <dt class="col-auto">Restart policy</dt>
                                    <dd class="col" x-text="container.HostConfig.RestartPolicy.Name || 'no'"></dd>
                                </dl>
                            </div>
                            <!-- Capabilities -->
                            <div class="tab-pane fade" :id="`capabilities-tab-pane-${container.Id}`" role="tabpanel"
                                :aria-labelledby="`capabilities-tab-${container.Id}`" tabindex="0">
                                <dl class="row">
                                    <dt class="col-auto">Capabilities added</dt>
                                    <dd class="col">
                                        <template
                                            x-if="'CapAdd' in container.HostConfig && container.HostConfig.CapAdd != null">
                                            <code x-text="container.HostConfig.CapAdd"></code>
                                        </template>
                                        <template
                                            x-if="!('CapAdd' in container.HostConfig && container.HostConfig.CapAdd != null)">
                                            <code><i class="bi bi-patch-minus" title="No value"></i></code>
                                        </template>
                                    </dd>

                                    <dt class="col-auto">Capabilities dropped</dt>
                                    <dd class="col">
                                        <template
                                            x-if="'CapDrop' in container.HostConfig && container.HostConfig.CapDrop != null">
                                            <code x-text="container.HostConfig.CapDrop"></code>
                                        </template>
                                        <template
                                            x-if="!('CapDrop' in container.HostConfig && container.HostConfig.CapDrop != null)">
                                            <code><i class="bi bi-patch-minus" title="No value"></i></code>
                                        </template>
                                    </dd>
                                </dl>
                            </div>
                            <!-- Resources -->
                            <div class=" tab-pane fade" :id="`resources-tab-pane-${container.Id}`" role="tabpanel"
                                :aria-labelledby="`resources-tab-${container.Id}`" tabindex="0">
                                <dl class="row">
                                    <dt class="col-auto">Memory limit</dt>
                                    <dd class="col"><code
                                            x-text="'Memory' in container.HostConfig ? parseInt(container.HostConfig.Memory) / 1024 / 1024 : '0'"></code>&nbsp;MB
                                    </dd>
                                </dl>
                            </div>
                            <!-- Healthcheck -->
                            <div class="tab-pane fade" :id="`healthcheck-tab-pane-${container.Id}`" role="tabpanel"
                                :aria-labelledby="`healthcheck-tab-${container.Id}`" tabindex="0">
                                <template x-if="'Healthcheck' in container.Config">
                                    <dl class="row">
                                        <dt class="col-sm-2">Test</dt>
                                        <dd class="col-sm-10 text-nowrap">
                                            <template
                                                x-if="'Healthcheck' in container.Config && container.Config.Healthcheck.Test.length > 0">
                                                <code
                                                    x-text="container.Config.Healthcheck.Test.slice(1).join(' ')"></code>
                                            </template>
                                        </dd>

                                        <dt class="col-sm-2">Interval</dt>
                                        <dd class="col-sm-10">
                                            <template x-if="'Interval' in container.Config.Healthcheck">
                                                <span><code
                                                        x-text="container.Config.Healthcheck.Interval / 1000 / 1000 / 1000"></code>&nbsp;s</span>
                                            </template>
                                            <template x-if="!('Interval' in container.Config.Healthcheck)">
                                                <code><i class="bi bi-patch-minus" title="Empty value"></i></code>
                                            </template>
                                        </dd>

                                        <dt class="col-sm-2">Timeout</dt>
                                        <dd class="col-sm-10">
                                            <template x-if="'Timeout' in container.Config.Healthcheck">
                                                <span><code
                                                        x-text="container.Config.Healthcheck.Timeout / 1000 / 1000 / 1000"></code>&nbsp;s</span>
                                            </template>
                                            <template x-if="!('Timeout' in container.Config.Healthcheck)">
                                                <code><i class="bi bi-patch-minus" title="Empty value"></i></code>
                                            </template>
                                        </dd>

                                        <dt class="col-sm-2">Retries</dt>
                                        <dd class="col-sm-10">
                                            <template x-if="'Retries' in container.Config.Healthcheck">
                                                <span><code
                                                        x-text="container.Config.Healthcheck.Retries"></code>&nbsp;count(s)</span>
                                            </template>
                                            <template x-if="!('Retries' in container.Config.Healthcheck)">
                                                <code><i class="bi bi-patch-minus" title="Empty value"></i></code>
                                            </template>
                                        </dd>

                                        <dt class="col-sm-2">Start period</dt>
                                        <dd class="col-sm-10">
                                            <template x-if="'StartPeriod' in container.Config.Healthcheck">
                                                <span><code
                                                        x-text="container.Config.Healthcheck.StartPeriod / 1000 / 1000 / 1000"></code>&nbsp;s</span>
                                            </template>
                                            <template x-if="!('StartPeriod' in container.Config.Healthcheck)">
                                                <code><i class="bi bi-patch-minus" title="Empty value"></i></code>
                                            </template>
                                        </dd>

                                        <dt class="col-sm-2">Start interval</dt>
                                        <dd class="col-sm-10">
                                            <template x-if="'StartInterval' in container.Config.Healthcheck">
                                                <span><code
                                                        x-text="container.Config.Healthcheck.StartInterval / 1000 / 1000 / 1000"></code>&nbsp;s</span>
                                            </template>
                                            <template x-if="!('StartInterval' in container.Config.Healthcheck)">
                                                <code><i class="bi bi-patch-minus" title="Empty value"></i></code>
                                            </template>
                                        </dd>
                                    </dl>
                                </template>
                                <template x-if="!('Healthcheck' in container.Config)">
                                    <p>No healthcheck</p>
                                </template>
                            </div>
                            <!-- Logging driver -->
                            <div class="tab-pane fade" :id="`logging-driver-tab-pane-${container.Id}`" role="tabpanel"
                                :aria-labelledby="`logging-driver-tab-${container.Id}`" tabindex="0">
                                <template x-if="'LogConfig' in container.HostConfig">
                                    <dl class="row mb-0">
                                        <dt class="col-auto">Type</dt>
                                        <dd class="col"><code x-text="container.HostConfig.LogConfig.Type"></code></dd>

                                        <dt>Config</dt>
                                        <dd>
                                            <template
                                                x-if="Object.entries(container.HostConfig.LogConfig.Config).length > 0">
                                                <template
                                                    x-for="[key, value] of Object.entries(container.HostConfig.LogConfig.Config)">
                                                    <dl class="row justify-content-start mb-1">
                                                        <dt class="col-auto text-nowrap"><code x-text="key"></code></dt>
                                                        <dd class="col"><code x-text="value"></code></dd>
                                                    </dl>
                                                </template>
                                            </template>
                                            <template
                                                x-if="Object.entries(container.HostConfig.LogConfig.Config).length === 0">
                                                <span>No Config</span>
                                            </template>
                                        </dd>
                                    </dl>
                                </template>
                                <template x-if="!('LogConfig' in container.HostConfig)">
                                    <p>No logging driver</p>
                                </template>
                            </div>
                            <!-- Extras -->
                            <div class="tab-pane fade" :id="`extras-tab-pane-${container.Id}`" role="tabpanel"
                                :aria-labelledby="`extras-tab-${container.Id}`" tabindex="0">
                                <dl class="row">
                                    <dt class="col-auto">Pid mode</dt>
                                    <dd class="col">
                                        <template x-if="container.HostConfig.PidMode !== ''">
                                            <code x-text="container.HostConfig.PidMode"></code>
                                        </template>
                                        <template x-if="container.HostConfig.PidMode === ''">
                                            <code><i class="bi bi-patch-minus" title="Empty value"></i></code>
                                        </template>
                                    </dd>
                                </dl>
                            </div>
                            <!-- Command Exec -->
                            <div class="tab-pane fade" :id="`exec-tab-pane-${container.Id}`" role="tabpanel"
                                :aria-labelledby="`exec-tab-${container.Id}`" tabindex="0" x-data="exec">
                                <div class="input-group">
                                    <label class="input-group-text"
                                        :for="`exec-command-${container.Id}`">Command</label>
                                    <input class="form-control font-monospace" :id="`exec-command-${container.Id}`"
                                        @keyup.enter="exec(container.Id)"
                                        :disabled="container.State.Running !== true || container.State.Paused === true"
                                        x-model="cmd" type="text">
                                    <button class="btn btn-primary"
                                        :disabled="container.State.Running !== true || container.State.Paused === true"
                                        @click="exec(container.Id)">Exec</button>
                                </div>

                                <div class="position-relative" x-data="{ copied: false }">
                                    <pre x-show="stdout.length > 0"
                                        class="p-2 mt-3 mb-0 text-light bg-dark overflow-scroll border border-dark-subtle"
                                        x-text="stdout">

                                        </pre>
                                    <button x-show="stdout.length > 0" title="Copy to clipboard"
                                        class="btn position-absolute top-0 end-0" </div>
                                        @click="navigator.clipboard.writeText(stdout); copied = true; setTimeout(()
                                        => copied = false, 3000)"><i class="bi text-light"
                                            :class="copied ? 'bi-check-lg' : 'bi-clipboard'"></i></button>
                                </div>
                            </div>
                            <!-- Terminal -->
                            <div class="tab-pane fade" :id="`terminal-tab-pane-${container.Id}`" role="tabpanel"
                                :aria-labelledby="`terminal-tab-${container.Id}`" tabindex="0" x-data="terminal">
                                <div class="input-group">
                                    <label class="input-group-text" :for="`terminal-${container.Id}`">Shell</label>
                                    <select class="form-control font-monospace" :id="`terminal-${container.Id}`"
                                        :disabled="container.State.Running !== true || container.State.Paused === true"
                                        x-model="shell">
                                        <option value="/bin/bash"><code>/bin/bash</code></option>
                                        <option value="/bin/sh"><code>/bin/sh</code></option>
                                    </select>
                                    <button class="btn btn-primary"
                                        :disabled="container.State.Running !== true || container.State.Paused === true"
                                        @click="openTerminal(container.Id)">Open</button>
                                </div>
                                <div class="alert alert-danger mt-3 mb-0" x-show="error" x-text="message"></div>
                                <div class="p-2 mt-3 rounded-1" x-ref="terminal" x-show="opened"
                                    style="background-color: #2D2E2C;"></div>
                            </div>
                            <!-- Logs -->
                            <div class="tab-pane fade" :id="`logs-tab-pane-${container.Id}`" role="tabpanel"
                                :aria-labelledby="`logs-tab-${container.Id}`" tabindex="0"
                                @get-logs.window="$event.detail.id === container.Id ? getLogs(container.Id):null"
                                x-data="logs">
                                <div class="position-relative" x-data="{ copied: false }">
                                    <pre x-show="logs.length > 0"
                                        class="p-2 mt-3 mb-0 text-light bg-dark overflow-scroll border border-dark-subtle"
                                        x-text="logs"></pre>
                                    <button x-show="logs.length > 0" title="Copy to clipboard"
                                        class="btn position-absolute top-0 end-0"
                                        @click="navigator.clipboard.writeText(logs); copied = true; setTimeout(() => copied = false, 3000)"><i
                                            class="bi text-light"
                                            :class="copied ? 'bi-check-lg' : 'bi-clipboard'"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </template>
        </template>
        <template x-if="containers.length == 0">
            <p>Searching containers...</p>
        </template>
    </div>
</body>
<script>
    document.addEventListener('alpine:init', () => {
        Alpine.data('exec', () => ({
            async exec(containerId) {
                if (this.cmd.length > 0) {
                    const response = await fetch(`/api/engine/containers/${containerId}/exec`, {
                        method: 'PUT',
                        body: JSON.stringify({ cmd: this.cmd.split(' ') }),
                        headers: {
                            'Content-Type': 'application/json',
                        }
                    });
                    this.stdout = (await response.json()).stdout;
                }
            },
            stdout: '',
            cmd: ''
        }));

        Alpine.data('logs', () => ({
            async getLogs(containerId) {
                const response = await fetch(`/api/engine/containers/${containerId}/logs`);
                this.logs = (await response.text());
            },
            logs: ''
        }));

        Alpine.data('terminal', () => ({
            async openTerminal(containerId) {
                const response = await fetch(`/api/engine/containers/${containerId}/ws`, {
                    method: "POST",
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });

                this.error = false;
                this.message = '';

                if (response.status !== 200) {
                    this.error = true;
                    this.message = (await response.json()).message;
                    return;
                }

                const result = await response.json();

                let url = new URL(window.location.origin);
                url.protocol = url.protocol.startsWith("https") ? "wss" : "ws";

                const client = new DockerExecWebsocketClient({
                    url: url.toString().slice(0, -1) + result.path,
                    tty: true,
                    command: [this.shell],
                });
                client.execute();

                const elemTerminal = this.$refs.terminal;

                const term = new Terminal({
                    theme: {
                        foreground: '#F8F8F8',
                        background: '#2D2E2C',
                        selection: '#5DA5D533',
                        black: '#1E1E1D',
                        brightBlack: '#262625',
                        red: '#CE5C5C',
                        brightRed: '#FF7272',
                        green: '#5BCC5B',
                        brightGreen: '#72FF72',
                        yellow: '#CCCC5B',
                        brightYellow: '#FFFF72',
                        blue: '#5D5DD3',
                        brightBlue: '#7279FF',
                        magenta: '#BC5ED1',
                        brightMagenta: '#E572FF',
                        cyan: '#5DA5D5',
                        brightCyan: '#72F0FF',
                        white: '#F8F8F8',
                        brightWhite: '#FFFFFF'
                    },
                    cursorBlink: true
                });

                term.open(elemTerminal);
                this.opened = true;
                await new Promise(r => setTimeout(r, 20));
                term.focus();

                term.onData(e => {
                    client.stdin.write(e);
                });

                client.stdout.on('data', function (data) {
                    term.write(String.fromCharCode.apply(null, data));
                });

                client.stderr.on('data', function (data) {
                    term.write(String.fromCharCode.apply(null, data));
                });

                client.on("exit", e => {
                    this.destroyTerminal(term)
                });

                client.on("shutdown", e => {
                    this.destroyTerminal(term)
                });
            },

            destroyTerminal(term) {
                term.dispose();
                this.opened = false;
            },

            shell: '/bin/bash',
            opened: false,
            error: false,
            message: '',
        }));
    });
</script>

</html>
